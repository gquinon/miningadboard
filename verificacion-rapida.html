<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ Verificaci√≥n R√°pida</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .result {
            background: #16213e;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #0f3460;
        }
        
        .success {
            border-left-color: #2ecc71;
        }
        
        .error {
            border-left-color: #e74c3c;
        }
        
        .warning {
            border-left-color: #f39c12;
        }
        
        h1 {
            color: #58b5ff;
            text-align: center;
        }
        
        pre {
            background: #0f0f23;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        .btn {
            background: #58b5ff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #4a9fd8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #2ecc71;
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .actions {
            text-align: center;
            margin: 30px 0;
        }
    </style>
</head>
<body>
    <h1>‚úÖ Verificaci√≥n R√°pida del Sistema</h1>
    
    <div class="actions">
        <button class="btn" onclick="runTests()">üîç Ejecutar Verificaci√≥n</button>
        <button class="btn btn-success" onclick="window.location.href='Panel-Admin-Nuevo.html'">üìä Ir al Panel Admin</button>
    </div>
    
    <div id="results"></div>

    <!-- Cargar scripts necesarios EN ORDEN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- 1. Primero config.js -->
    <script src="config.js"></script>
    
    <!-- 2. Luego Firebase Manager (usa config.js) -->
    <script src="firebase-manager-universal.js"></script>
    
    <!-- 3. Database Manager -->
    <script src="database-manager.js"></script>
    
    <!-- 4. Mass Operations -->
    <script src="mass-operations.js"></script>

    <script>
        async function runTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result">‚è≥ Ejecutando pruebas...</div>';
            
            const results = [];
            
            // Test 1: XLSX
            results.push({
                name: 'üìö Librer√≠a XLSX',
                success: typeof XLSX !== 'undefined',
                details: typeof XLSX !== 'undefined' ? `Versi√≥n: ${XLSX.version}` : 'No disponible'
            });
            
            // Test 2: Config
            results.push({
                name: '‚öôÔ∏è DashboardConfig',
                success: typeof window.DashboardConfig !== 'undefined',
                details: window.DashboardConfig ? `App: ${window.DashboardConfig.app.name}` : 'No disponible'
            });
            
            // Test 3: Firebase Config
            const hasConfigInDashboard = window.DashboardConfig && window.DashboardConfig.firebaseConfig;
            const hasGlobalConfig = window.firebaseConfig;
            const configSuccess = hasConfigInDashboard || hasGlobalConfig;
            
            let configDetails = '';
            if (hasConfigInDashboard) {
                configDetails = `‚úÖ DashboardConfig.firebaseConfig - ProjectId: ${window.DashboardConfig.firebaseConfig.projectId}`;
            } else if (hasGlobalConfig) {
                configDetails = `‚úÖ window.firebaseConfig - ProjectId: ${window.firebaseConfig.projectId}`;
            } else {
                configDetails = '‚ùå No se encontr√≥ firebaseConfig en ninguna ubicaci√≥n';
            }
            
            results.push({
                name: 'üî• Firebase Config',
                success: configSuccess,
                details: configDetails
            });
            
            // Test 4: Database Manager
            await new Promise(resolve => setTimeout(resolve, 1000));
            results.push({
                name: 'üíæ Database Manager',
                success: typeof window.dbManager !== 'undefined',
                details: window.dbManager ? 
                    `Datos: ${window.dbManager.data?.data?.length || 0} proyectos` : 
                    'No disponible'
            });
            
            // Test 5: Firebase Manager
            results.push({
                name: 'üåê Firebase Manager',
                success: typeof window.firebaseManager !== 'undefined',
                details: window.firebaseManager ? 
                    `BaseURL: ${window.firebaseManager.baseURL ? 'OK' : 'ERROR'}` : 
                    'No disponible'
            });
            
            // Test 6: Mass Operations
            results.push({
                name: '‚ö° Mass Operations',
                success: typeof massLoadFromExcel !== 'undefined' || typeof cargarDatosDesdeExcel !== 'undefined',
                details: typeof massLoadFromExcel !== 'undefined' ? 
                    'massLoadFromExcel disponible' : 
                    (typeof cargarDatosDesdeExcel !== 'undefined' ? 'cargarDatosDesdeExcel disponible' : 'No disponible')
            });
            
            // Test 7: LocalStorage
            let localStorageTest = false;
            let localStorageDetails = '';
            try {
                const testKey = 'test_' + Date.now();
                localStorage.setItem(testKey, 'test');
                localStorage.removeItem(testKey);
                
                const mineroData = localStorage.getItem('minero_database');
                if (mineroData) {
                    const parsed = JSON.parse(mineroData);
                    localStorageDetails = `${parsed.data?.length || 0} proyectos almacenados`;
                } else {
                    localStorageDetails = 'Vac√≠o';
                }
                localStorageTest = true;
            } catch (error) {
                localStorageDetails = 'Error: ' + error.message;
            }
            
            results.push({
                name: 'üíø LocalStorage',
                success: localStorageTest,
                details: localStorageDetails
            });
            
            // Test 8: proyectos.json
            try {
                const response = await fetch('proyectos.json');
                const data = await response.json();
                results.push({
                    name: 'üìÑ proyectos.json',
                    success: response.ok && data.data && data.data.length > 0,
                    details: `${data.data?.length || 0} proyectos, ${data.columns?.length || 0} columnas`
                });
            } catch (error) {
                results.push({
                    name: 'üìÑ proyectos.json',
                    success: false,
                    details: 'Error: ' + error.message
                });
            }
            
            // Mostrar resultados
            displayResults(results);
        }
        
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            
            const passed = results.filter(r => r.success).length;
            const total = results.length;
            
            let html = `
                <div class="result ${passed === total ? 'success' : 'warning'}">
                    <h2>üìä Resumen: ${passed}/${total} pruebas exitosas</h2>
                </div>
            `;
            
            results.forEach(result => {
                html += `
                    <div class="result ${result.success ? 'success' : 'error'}">
                        <strong>${result.success ? '‚úÖ' : '‚ùå'} ${result.name}</strong>
                        <pre>${result.details}</pre>
                    </div>
                `;
            });
            
            if (passed === total) {
                html += `
                    <div class="result success">
                        <h2>üéâ ¬°TODOS LOS COMPONENTES FUNCIONANDO!</h2>
                        <p>El sistema est√° listo para usar.</p>
                    </div>
                    <div class="actions">
                        <button class="btn btn-success" onclick="window.location.href='Panel-Admin-Nuevo.html'">
                            üöÄ Abrir Panel de Administraci√≥n
                        </button>
                    </div>
                `;
            } else {
                html += `
                    <div class="result error">
                        <h2>‚ö†Ô∏è Algunos componentes tienen problemas</h2>
                        <p>Revisa los errores arriba y corrige los componentes marcados en rojo.</p>
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = html;
        }
        
        // Ejecutar autom√°ticamente al cargar
        window.addEventListener('load', () => {
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>
